{"version":3,"sources":["rxjsd/Queue.tsx"],"names":["Queue","source","useRef","content","subject","Subject","useState","nums","setNums","useEffect","subscription","current","pipe","concatMap","v","interval","take","map","x","subscribe","writeBall","console","log","unsubscribe","style","margin","overflow","ref","onClick","random","Math","next","height","position","n","key","num","RANGE","currentOffset","color","join","ball","document","createElement","top","left","width","background","borderRadius","fontSize","textAlign","lineHeight","boxShadow","innerHTML","toString","appendChild","id","setInterval","clearInterval","removeChild"],"mappings":"6NAIe,SAASA,IACtB,IAAMC,EAASC,iBAA0B,MACnCC,EAAUD,iBAAuB,MACjCE,EAAUF,iBAAwB,IAAIG,KAHd,EAINC,mBAAmB,IAJb,mBAIvBC,EAJuB,KAIjBC,EAJiB,KA0B9B,OAfAC,qBAAU,WACR,IAGMC,EAHaN,EAAQO,QAAQC,KACjCC,aAAU,SAAAC,GAAC,OAAIC,YAAS,KAAMH,KAAKI,YAAK,GAAIC,aAAI,SAAAC,GAAC,OAAIJ,UAEvBK,WAAU,SAAAL,GACxCX,EAAQQ,SAAWS,EAAUN,EAAGX,EAAQQ,YAK1C,OAHAP,EAAQO,QAAQQ,WAAU,SAAAL,GACxBO,QAAQC,IAAIR,MAEP,WACLJ,EAAaa,iBAEd,IAGD,sBAAKC,MAAO,CAAEC,OAAQ,GAAIC,SAAU,SAApC,UACE,+DACA,wBAAQC,IAAK1B,EAAQ2B,QAxBX,WACZ,IAAMC,KAA4B,GAAhBC,KAAKD,UACvBzB,EAAQO,QAAQoB,KAAKF,GACrBrB,EAAQ,CAACqB,GAAF,mBAAatB,MAqBlB,oBACA,qBAAKiB,MAAO,CAAEQ,OAAQ,IAAKC,SAAU,YAAcN,IAAKxB,IACxD,8BAAMI,EAAKU,KAAI,SAACiB,EAAGC,GAAJ,OAAY,sBAAgBX,MAAO,CAAEC,OAAQ,SAAjC,SAA6CS,GAAlCC,WAM5C,IAAMf,EAAY,SAACgB,EAAajC,GAC9B,IAAMkC,EAAQ,CAAC,EAAG,IACdC,EAAgBD,EAAM,GAIpBE,EAAQ,QAAU,CACN,IAAhBT,KAAKD,SACW,IAAhBC,KAAKD,SACW,IAAhBC,KAAKD,UACLW,KAAK,KAAO,OACRC,EAAOC,SAASC,cAAc,OACpCF,EAAKjB,MAAMS,SAAW,WACtBQ,EAAKjB,MAAMoB,IAAM,OACjBH,EAAKjB,MAAMqB,KAAOR,EAAM,GAAK,IAC7BI,EAAKjB,MAAMsB,MAAQ,OACnBL,EAAKjB,MAAMQ,OAAS,OACpBS,EAAKjB,MAAMuB,WAAaR,EACxBE,EAAKjB,MAAMwB,aAAe,MAC1BP,EAAKjB,MAAMyB,SAAW,OACtBR,EAAKjB,MAAM0B,UAAY,SACvBT,EAAKjB,MAAM2B,WAAa,OACxBV,EAAKjB,MAAMe,MAAQ,OACnBE,EAAKjB,MAAM4B,UAAY,mBACvBX,EAAKY,UAAYjB,EAAIkB,WACrBnD,EAAQoD,YAAYd,GAEpB,IAAMe,EAAKC,aAAY,WACrBnB,GAzBgB,GA0BhBG,EAAKjB,MAAMqB,KAAOP,EAAgB,IAC9BA,EAAgBD,EAAM,KACxBqB,cAAcF,GACdrD,EAAQwD,YAAYlB,MAErB","file":"static/js/25.ba553454.chunk.js","sourcesContent":["import { useRef, useEffect, useState } from 'react'\nimport { interval, Subject } from 'rxjs';\nimport { map, concatMap, take } from 'rxjs/operators';\n\nexport default function Queue() {\n  const source = useRef<HTMLButtonElement>(null)\n  const content = useRef<HTMLDivElement>(null)\n  const subject = useRef<Subject<number>>(new Subject())\n  const [nums, setNums] = useState<number[]>([])\n  const click = () => {\n    const random = ~~(Math.random() * 10)\n    subject.current.next(random)\n    setNums([random, ...nums])\n  }\n\n  useEffect(() => {\n    const observable = subject.current.pipe(\n      concatMap(v => interval(1000).pipe(take(1), map(x => v)))\n    )\n    const subscription = observable.subscribe(v => {\n      content.current && writeBall(v, content.current)\n    })\n    subject.current.subscribe(v => {\n      console.log(v)\n    })\n    return () => {\n      subscription.unsubscribe()\n    }\n  }, [])\n\n  return (\n    <div style={{ margin: 10, overflow: 'hiden' }}>\n      <h1>RxJs 队列实现</h1>\n      <button ref={source} onClick={click}>source</button>\n      <div style={{ height: 100, position: 'relative' }} ref={content}></div>\n      <div>{nums.map((n, key) => <span key={key} style={{ margin: '0 5px' }}>{n}</span>)}</div>\n    </div>\n  )\n}\n\n//写入流\nconst writeBall = (num: number, content: HTMLDivElement) => {\n  const RANGE = [0, 80] as const\n  let currentOffset = RANGE[0]\n  const INCREMENT = .2\n  const FPS = 40\n\n  const color = 'rgba(' + [\n    Math.random() * 255,\n    Math.random() * 255,\n    Math.random() * 255\n  ].join(',') + ', 1)'\n  const ball = document.createElement('div')\n  ball.style.position = 'absolute'\n  ball.style.top = '25px'\n  ball.style.left = RANGE[0] + '%'\n  ball.style.width = '50px'\n  ball.style.height = '50px'\n  ball.style.background = color\n  ball.style.borderRadius = '50%'\n  ball.style.fontSize = '16px'\n  ball.style.textAlign = 'center'\n  ball.style.lineHeight = '50px'\n  ball.style.color = '#fff'\n  ball.style.boxShadow = '1px 1px 1px #bbb'\n  ball.innerHTML = num.toString()\n  content.appendChild(ball)\n\n  const id = setInterval(() => {\n    currentOffset += INCREMENT\n    ball.style.left = currentOffset + '%'\n    if (currentOffset > RANGE[1]) {\n      clearInterval(id)\n      content.removeChild(ball)\n    }\n  }, 1000 / FPS)\n}\n"],"sourceRoot":""}